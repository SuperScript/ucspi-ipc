\documentclass{book}
\usepackage{sstdef}
\title{ucspi-ipc}

\begin{document}

\section{\cmd{getpeereid}}

When it accepts a connection, \cmd{ipcserver} uses the effective user
ID and effective group ID of the process that called \cmd{connect} to
decide whether to handle the connection or drop it immediately.
Therefore ucspi-ipc requires operating system support for passing the
client credentials to the server.  For discussions of various
credential-passing mechanisms, see D.J. Bernstein's
\href{Secure interprocess communication}{http://cr.yp.to/docs/secureipc.html}
and the BugTraq mailing list thread stemming from
\href{Wiping out setuid programs}{http://www.securityfocus.com/templates/archive.pike?list=1&date=1999-01-01&msg=19990106040754.18811.qmail@cr.yp.to}.

ucspi-ipc uses \cmd{getpeereid} to obtain client credentials.  Unless
your operating system supports an implementation of \cmd{getpeereid},
you cannot use ucspi-ipc.

\subsection{Prototype}
\begin{code}%
  int getpeereid(int \var{s},uid_t *\var{u},gid_t *\var{g});
\end{code}

\cvar{s} is the result of a successful \cmd{accept} on a local-domain
stream socket.

\cvar{u} and \cvar{g} are pointers to addresses where the user and group
IDs are stored.

Upon success, \cmd{getpeereid} stores user and group IDs at \cvar{u}
and \cvar{g}, respectively, and returns 0.  If an error occurs,
\cmd{getpeereid} sets \cmd{errno} appropriately, and returns -1.


\subsection{Implementations}
Recent Linux kernels that support \cmd{SO_PEERCRED} with
\cmd{getsockopt} provide sufficient basis for a getpeereid function.
Various systems offer a \cmd{gepeereid} system call, including
\href{OpenBSD~3.0}{http://www.openbsd.org},
\href{FreeBSD~4.6}{http://www.freebsd.org}, and
\href{AIX~5L}{http://www-1.ibm.com/servers/aix/index.html}.

Experimental operating system \href{patches}{../patches/index.html}
that add a \cmd{getpeereid} system call are available for several BSD
variants.

\end{document}
